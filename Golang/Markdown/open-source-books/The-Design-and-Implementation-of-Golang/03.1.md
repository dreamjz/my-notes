---
title: 'Golang 数组实现原理'
date: '2021-03-24'
categories:
 - golang
tags: 
 - array
publish: true
---

## 3.1.1 概述

数组是由相同类型元素的集合组成的数据结构，计算机会为数组分配一块连续的内存来保存其中的元素，我们可以利用数组中的元素的索引快速访问特定元素，常见的数组多为一维线性数组，而多维数组在数值和图形计算领域有比较常见的应用。

![3D-array](image/2019-02-20-3D-array.jpg)

<center><b>图 3 - 1  多维数组</b></center>

 数组作为一种基本数据类型，通常会从两个维度描述数组，也就是数组中存储的**元素类型**和数组**最大能存储的元素个数**，在 Golang 中使用如下方式表示数组类型：

```go
[10]int
[200]interface{}
```

Go 语言数组在初始化之后大小无法改变，存储元素类型相同、但是大小不同的数组类型在 Go 语言中是完全不同的，只有满足两个条件相同时才为同一类型。

```go
func NewArray(elem *Type, bound int64) *Type {
	if bound < 0 {
		Fatalf("NewArray: invalid bound %v", bound)
	}
	t := New(TARRAY)
	t.Extra = &Array{Elem: elem, Bound: bound}
	t.SetNotInHeap(elem.NotInHeap())
	return t
}
```

编译期间数组类型由上述的 [`cmd/compile/internal/types.NewArray`](https://draveness.me/golang/tree/cmd/compile/internal/types.NewArray) 函数生成，该类型包含两个字段，分别是元素类型 `Elem` 和 数组大小 `Bound`，这两个字段共同构成了数组类型，而当前数组是否应该在堆栈中初始化也在编译期就确定了。

## 3.1.2 初始化

Go 语言的数组由两种不同的创建方式，一种是**显式的指定数组大小**，另一种是使用 `[...]T` 声明数组，Go 语言会在编译期间通过源代码推导数组的大小：

```go
arr1 := [3]int{1, 2, 3}
arr2 := [...]int{1, 2, 3}
```

上述两种声明方式在运行期间得到的结果是完全相同的，后一种方式在编译期间会被转换成前一种，这也就是编译器对数组大小的推导，下面看下编译器的推导过程。

### 上限推导



## Reference

1. [Go 语言设计与实现](https://draveness.me/golang) 